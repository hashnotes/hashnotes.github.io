(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const t of r.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&a(t)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const be=["click","mousemove","mouseup","mousedown","drag","wheel"],xe=["keydown","keyup"],se="http://www.w3.org/2000/svg",$e=new Set(["svg","path","g","line","polyline","polygon","circle","ellipse","rect","text"]),ke=new Set(["viewBox","width","height","xmlns","d","fill","stroke","stroke-width","stroke-linecap","stroke-linejoin","stroke-dasharray","stroke-dashoffset","x","y","x1","y1","x2","y2","cx","cy","r","rx","ry","points","transform","opacity","font-size","font-family","font-weight","text-anchor","dominant-baseline","dx","dy"]);let F=new WeakMap,j=new WeakMap;const Se=e=>{const s=n=>{const a=$e.has(n.tag)?document.createElementNS(se,n.tag):document.createElement(n.tag);return a.textContent=n.textContent,(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&n.value&&(a.value=n.value),j.set(n,a),F.set(a,n),a.append(...n.children.map(o=>s(o))),Object.entries(n.attrs).forEach(([o,r])=>{ke.has(o)&&a.setAttribute(o,r)}),Object.entries(n.style).forEach(o=>a.style.setProperty(...o)),be.forEach(o=>a.addEventListener(o,r=>{const t=r;n.onEvent!=null&&n.onEvent({type:o,target:F.get(r.target),clientX:t.clientX,clientY:t.clientY,deltaY:o==="wheel"?t.deltaY:void 0,currentTarget:a,preventDefault:()=>r.preventDefault()})})),xe.forEach(o=>a.addEventListener(o,r=>{let{key:t,metaKey:m,shiftKey:p}=r;["INPUT","TEXTAREA"].includes(r.target.tagName)&&(n.value=r.target.value),n.onEvent!=null&&n.onEvent({type:o,key:t,metaKey:m,shiftKey:p,target:F.get(r.target)})})),a};return s(e({add:(n,...a)=>{var o;(o=j.get(n))==null||o.append(...a.map(r=>s(r)))},del:n=>{var a;F.delete(j.get(n)),(a=j.get(n))==null||a.remove(),j.delete(n)},update:n=>{let a=j.get(n);a.replaceWith(s(n)),F.delete(a)}}))},b=e=>(...s)=>{let n=new Map,a={tag:e,style:{},attrs:{},textContent:"",id:"",children:[],onEvent:r=>{let t=n.get(r.type);if(t)return t(r)}},o=r=>{if(r instanceof Array)r.forEach(o);else if(typeof r=="string")a.textContent=r;else if(r instanceof Object){if("tag"in r)return a.children.push(r);"id"in r&&(a.id=r.id),"value"in r&&(a.value=r.value),"attrs"in r&&Object.entries(r.attrs).forEach(([t,m])=>a.attrs[t]=m),"style"in r&&Object.entries(r.style).forEach(t=>a.style[t[0].replace(/([A-Z])/g,"-$1")]=t[1]),Object.entries(r).forEach(([t,m])=>{t.startsWith("on")&&n.set(t.slice(2),m)})}};return o(s),a};let q=b("div"),ve=b("svg"),Ae=b("path"),je=b("text");const Ie=(...e)=>{const s=q({style:{background:"var(--background-color)",color:"var(--color)",padding:"1em",paddingBottom:"2em",borderRadius:"1em",zIndex:"2000",overflowY:"scroll"}},...e);return q({style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(166, 166, 166, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2000"}},s)},Oe={div:q,span:b("span"),p:b("p"),h1:b("h1"),h2:b("h2"),h3:b("h3"),h4:b("h4"),h5:b("h5"),h6:b("h6"),a:b("a"),button:b("button"),input:b("input"),textarea:b("textarea"),pre:b("pre"),svgPath:(e,s={},...n)=>{const a=e instanceof Array?e:[e],{viewBox:o="0 0 24 24",width:r="1em",height:t="1em",fill:m="currentColor",stroke:p,strokeWidth:c}=s,y={fill:m};return p&&(y.stroke=p),c&&(y["stroke-width"]=c),ve({attrs:{viewBox:o,width:r,height:t,xmlns:se}},...a.map(f=>Ae({attrs:{...y,d:f}})),...n)},svgText:(e,s={})=>{const n={};return s.x&&(n.x=s.x),s.y&&(n.y=s.y),s.fill&&(n.fill=s.fill),s.background&&(n.background=s.background),s.fontSize&&(n["font-size"]=s.fontSize),s.fontFamily&&(n["font-family"]=s.fontFamily),s.fontWeight&&(n["font-weight"]=s.fontWeight),s.textAnchor&&(n["text-anchor"]=s.textAnchor),s.dominantBaseline&&(n["dominant-baseline"]=s.dominantBaseline),s.dx&&(n.dx=s.dx),s.dy&&(n.dy=s.dy),je({attrs:n},e)},popup:Ie},_e=0xcbf29ce484222325n,Fe=0x84222325cbf29ce4n,Le=0x100000001b3n,Be=(1n<<64n)-1n,ne=(e,s)=>{let n=s;for(let a=0;a<e.length;a+=1)n^=BigInt(e.charCodeAt(a)),n=n*Le&Be;return n},oe=e=>e.toString(16).padStart(16,"0"),V=(...e)=>{const s=JSON.stringify(e),n=ne(s,_e),a=ne(s,Fe);return`#${oe(n)}${oe(a)}`},K=e=>JSON.stringify(e,null,2),T=e=>JSON.parse(e),D=e=>typeof e=="string"&&/^#([a-f0-9]{32})$/i.test(e),C=e=>{if(D(e))return e;if(["string","number","boolean"].includes(typeof e)||e===null)return V(K(e));if(Array.isArray(e))return V("arr",e.map(C));if(typeof e=="object"){const s=Object.entries(e).sort(([n],[a])=>n<a?-1:n>a?1:0).map(([n,a])=>[n,C(a)]);return V(K(Object.fromEntries(s)))}throw new Error(`unsupported type for hashing: ${typeof e}`)},Pe="hashnotes";let U=localStorage.getItem("db_preset")=="local"?"local":"maincloud";const ie=()=>({local:"http://localhost:3000",maincloud:"https://maincloud.spacetimedb.com"})[U],ce=async()=>{let e=()=>`access_token:${U}`,s=e(),n=localStorage.getItem(s);if(!n){if(n=await fetch(`${ie()}/v1/identity`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(a=>a.json()).then(a=>a.token||null),s!=e())return ce();n&&localStorage.setItem(s,n)}return n};let Ce=()=>U;console.log("connect to",U);const J=async(e,s)=>{const n=await fetch(`${ie()}/v1/database/${Pe}/call/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:await ce().then(o=>o?`Bearer ${o}`:"")},body:JSON.stringify(s)}),a=await n.text();if(!n.ok)throw new Error(a);return a},L=new Map,M=new Map,z=new Map,ue=async(e,s={})=>{const{skipCache:n=!1}=s,a=C(e);if(!n){if(L.get(a)!==void 0)return a;const t=M.get(a);if(t)return t}const o=(async()=>(await J("add_note",{data:K(e)}),n||L.set(a,e),a))();n||M.set(a,o);try{return await o}finally{n||M.delete(a)}},le=async(e,s={})=>{const{skipCache:n=!1}=s;if(!n){const o=L.get(e);if(o!==void 0)return o;const r=M.get(e);if(r)try{await r;const m=L.get(e);if(m!==void 0)return m}catch{}const t=z.get(e);if(t)return t}const a=(async()=>{const o=await J("get_note",{hash:e}),r=T(T(o));return n||L.set(e,r),r})();n||z.set(e,a);try{return await a}finally{n||z.delete(e)}},B=async e=>D(e)?le(e).then(B):e,P=async e=>D(e)?e:ue(e),Ne=async(e,s)=>{const n=await P(e),a=await P(s===void 0?null:s);return await J("call_note",{fn:n,arg:a}).then(T).then(B)},Re=new Set(["if","else","return","await","typeof","let","const","for","while","in","of","break","continue","true","false","null"]),Me=e=>/[A-Za-z_$]/.test(e),Te=e=>/[A-Za-z0-9_$]/.test(e),W=e=>/[0-9]/.test(e),De=e=>{const s=[];let n=0;const a=(t,m,p)=>s.push({type:t,value:m,pos:p}),o=()=>e[n],r=()=>e[n++];for(;n<e.length;){const t=o();if(t===" "||t===`
`||t==="\r"||t==="	"){n++;continue}if(t==="/"&&e[n+1]==="/"){for(n+=2;n<e.length&&e[n]!==`
`;)n++;continue}if(t==="/"&&e[n+1]==="*"){for(n+=2;n<e.length&&!(e[n]==="*"&&e[n+1]==="/");)n++;n+=2;continue}if(t==="'"||t==='"'){const y=r();let f="";const $=n-1;for(;n<e.length;){const E=r();if(E==="\\"){const u=r();f+=u}else{if(E===y)break;f+=E}}a("string",f,$);continue}if(W(t)){const y=n;let f="";for(;n<e.length&&W(o());)f+=r();if(o()===".")for(f+=r();n<e.length&&W(o());)f+=r();a("number",f,y);continue}if(Me(t)){const y=n;let f="";for(;n<e.length&&Te(o());)f+=r();Re.has(f)?a("keyword",f,y):a("identifier",f,y);continue}const m=n,p=e.slice(n,n+2),c=e.slice(n,n+3);if(c==="==="||c==="!=="||c==="..."){n+=3,a("operator",c,m);continue}if(p==="&&"||p==="||"||p==="=="||p==="!="||p==="<="||p===">="||p==="=>"||p==="+="||p==="-="||p==="*="||p==="/="||p==="%="||p==="++"||p==="--"){n+=2,a("operator",p,m);continue}if("+-*/%<>=!.,;:?(){}[]".includes(t)){n++;const y=".;,(){}[]".includes(t)?"punct":"operator";a(y,t,m);continue}throw new Error(`Unexpected character '${t}' at ${n}`)}return s.push({type:"eof",value:"",pos:n}),s},Ue=(e,s=[])=>{const n=[],a=new Set(s),o=[new Set],r=u=>o[o.length-1].add(u),t=u=>o.some(w=>w.has(u))||a.has(u),m=()=>o.push(new Set),p=()=>{o.pop()},c=u=>{t(u)||n.push(`undeclared: ${u}`)},y=u=>{u.type==="Identifier"?r(u.name):u.type==="RestElement"?y(u.argument):u.type==="ArrayPattern"?u.elements.forEach(y):u.properties.forEach(w=>{w.type==="RestElement"?y(w.argument):y(w.value)})},f=u=>{switch(u.type){case"Identifier":c(u.name);return;case"Literal":return;case"SpreadElement":f(u.argument);return;case"ArrayExpression":u.elements.forEach(w=>f(w));return;case"ObjectExpression":u.properties.forEach(w=>{w.type==="SpreadElement"?f(w.argument):f(w.value)});return;case"AwaitExpression":f(u.argument);return;case"CallExpression":f(u.callee),u.arguments.forEach(w=>f(w));return;case"MemberExpression":f(u.object),u.computed&&f(u.property);return;case"AssignmentExpression":f(u.left),f(u.right);return;case"UpdateExpression":f(u.argument);return;case"BinaryExpression":case"LogicalExpression":f(u.left),f(u.right);return;case"UnaryExpression":f(u.argument);return;case"ConditionalExpression":f(u.test),f(u.consequent),f(u.alternate);return;case"ArrowFunctionExpression":m(),u.params.forEach(y),u.body.type==="BlockStatement"?E(u.body):f(u.body),p();return}},$=u=>{y(u.id),u.init&&f(u.init)},E=u=>{switch(u.type){case"BlockStatement":m(),u.body.forEach(E),p();return;case"ExpressionStatement":f(u.expression);return;case"IfStatement":f(u.test),E(u.consequent),u.alternate&&E(u.alternate);return;case"ReturnStatement":u.argument&&f(u.argument);return;case"VariableDeclaration":u.declarations.forEach($);return;case"WhileStatement":f(u.test),E(u.body);return;case"ForStatement":{m(),Array.isArray(u.init)?u.init.forEach($):u.init&&f(u.init),u.test&&f(u.test),u.update&&f(u.update),E(u.body),p();return}case"ForInStatement":case"ForOfStatement":{m(),Array.isArray(u.left)?u.left.forEach($):f(u.left),f(u.right),E(u.body),p();return}case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach(E),n},Ve=e=>{const s=[],n=new Set(["prototype","constructor","__proto__"]),a=r=>{switch(r.type){case"MemberExpression":!r.computed&&r.property.type==="Identifier"&&n.has(r.property.name)&&s.push("prototype access"),r.computed&&!(r.property.type==="Literal"&&typeof r.property.value=="number")&&s.push("only numeric literal indexing allowed"),a(r.object),r.computed&&a(r.property);return;case"SpreadElement":a(r.argument);return;case"CallExpression":a(r.callee),r.arguments.forEach(t=>a(t));return;case"AwaitExpression":a(r.argument);return;case"ArrayExpression":r.elements.forEach(t=>a(t));return;case"ObjectExpression":r.properties.forEach(t=>{t.type==="SpreadElement"?a(t.argument):a(t.value)});return;case"AssignmentExpression":a(r.left),a(r.right);return;case"UpdateExpression":a(r.argument);return;case"BinaryExpression":case"LogicalExpression":a(r.left),a(r.right);return;case"UnaryExpression":a(r.argument);return;case"ConditionalExpression":a(r.test),a(r.consequent),a(r.alternate);return;case"ArrowFunctionExpression":r.body.type==="BlockStatement"?o(r.body):a(r.body);return;case"Identifier":case"Literal":return}},o=r=>{switch(r.type){case"BlockStatement":r.body.forEach(o);return;case"ExpressionStatement":a(r.expression);return;case"IfStatement":a(r.test),o(r.consequent),r.alternate&&o(r.alternate);return;case"ReturnStatement":r.argument&&a(r.argument);return;case"VariableDeclaration":r.declarations.forEach(t=>t.init&&a(t.init));return;case"WhileStatement":a(r.test),o(r.body);return;case"ForStatement":Array.isArray(r.init)?r.init.forEach(t=>t.init&&a(t.init)):r.init&&a(r.init),r.test&&a(r.test),r.update&&a(r.update),o(r.body);return;case"ForInStatement":case"ForOfStatement":Array.isArray(r.left)?r.left.forEach(t=>t.init&&a(t.init)):a(r.left),a(r.right),o(r.body);return;case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach(o),s},ze=e=>{const s=De(e);let n=0;const a=()=>s[n],o=()=>s[n++],r=(i,l)=>{const d=a();if(d.type!==i||l!==void 0&&d.value!==l)throw new Error(`Expected ${l??i} at ${d.pos}`);return o()},t=(i,l)=>{const d=a();return d.type===i&&(l===void 0||d.value===l)},m=()=>{const i=[];for(;!t("eof");)i.push(p());return{type:"Program",body:i}},p=()=>{if(t("punct","{"))return c();if(t("keyword","if"))return y();if(t("keyword","while"))return u();if(t("keyword","for"))return w();if(t("keyword","break"))return o(),t("punct",";")&&o(),{type:"BreakStatement"};if(t("keyword","continue"))return o(),t("punct",";")&&o(),{type:"ContinueStatement"};if(t("keyword","return"))return f();if(t("keyword","let")||t("keyword","const"))return E();const i=g();return t("punct",";")&&o(),{type:"ExpressionStatement",expression:i}},c=()=>{r("punct","{");const i=[];for(;!t("punct","}");)i.push(p());return r("punct","}"),{type:"BlockStatement",body:i}},y=()=>{r("keyword","if"),r("punct","(");const i=g();r("punct",")");const l=p(),d=t("keyword","else")?(o(),p()):null;return{type:"IfStatement",test:i,consequent:l,alternate:d}},f=()=>{if(r("keyword","return"),t("punct",";"))return o(),{type:"ReturnStatement",argument:null};const i=t("punct","}")?null:g();return t("punct",";")&&o(),{type:"ReturnStatement",argument:i}},$=i=>{const l=o().value,d=[];do{const x=S(),O=t("operator","=")?(o(),g()):null;if(d.push({type:"VariableDeclarator",id:x,init:O}),!t("punct",","))break;o()}while(!0);return i&&t("punct",";")&&o(),{kind:l,declarations:d}},E=()=>{const{kind:i,declarations:l}=$(!0);return{type:"VariableDeclaration",kind:i,declarations:l}},u=()=>{r("keyword","while"),r("punct","(");const i=g();r("punct",")");const l=p();return{type:"WhileStatement",test:i,body:l}},w=()=>{r("keyword","for"),r("punct","(");let i=null,l=null;if(!t("punct",";"))if(t("keyword","let")||t("keyword","const")){const _=$(!1);i=_.declarations,l=_.kind}else i=g();if(t("keyword","in")||t("keyword","of")){const _=o().value,te=g();r("punct",")");const re=p();if(!i)throw new Error(`Expected initializer before ${_} at ${a().pos}`);return _==="in"?{type:"ForInStatement",left:i,leftKind:l,right:te,body:re}:{type:"ForOfStatement",left:i,leftKind:l,right:te,body:re}}r("punct",";");const d=t("punct",";")?null:g();r("punct",";");const x=t("punct",")")?null:g();r("punct",")");const O=p();return{type:"ForStatement",init:i,initKind:l,test:d,update:x,body:O}},g=()=>Z(),Z=()=>{const i=fe();if(t("operator","=")||t("operator","+=")||t("operator","-=")||t("operator","*=")||t("operator","/=")||t("operator","%=")){const l=o().value,d=Z();return{type:"AssignmentExpression",operator:l,left:i,right:d}}return i},fe=()=>{let i=de();if(t("operator","?")){o();const l=g();r("operator",":");const d=g();return{type:"ConditionalExpression",test:i,consequent:l,alternate:d}}return i},de=()=>{let i=Y();for(;t("operator","||");){const l=o().value,d=Y();i={type:"LogicalExpression",operator:l,left:i,right:d}}return i},Y=()=>{let i=X();for(;t("operator","&&");){const l=o().value,d=X();i={type:"LogicalExpression",operator:l,left:i,right:d}}return i},X=()=>{let i=G();for(;t("operator","==")||t("operator","!=")||t("operator","===")||t("operator","!==");){const l=o().value,d=G();i={type:"BinaryExpression",operator:l,left:i,right:d}}return i},G=()=>{let i=Q();for(;t("operator","<")||t("operator","<=")||t("operator",">")||t("operator",">=");){const l=o().value,d=Q();i={type:"BinaryExpression",operator:l,left:i,right:d}}return i},Q=()=>{let i=ee();for(;t("operator","+")||t("operator","-");){const l=o().value,d=ee();i={type:"BinaryExpression",operator:l,left:i,right:d}}return i},ee=()=>{let i=A();for(;t("operator","*")||t("operator","/")||t("operator","%");){const l=o().value,d=A();i={type:"BinaryExpression",operator:l,left:i,right:d}}return i},A=()=>t("keyword","await")?(o(),{type:"AwaitExpression",argument:A()}):t("operator","++")||t("operator","--")?{type:"UpdateExpression",operator:o().value,argument:A(),prefix:!0}:t("keyword","typeof")?(o(),{type:"UnaryExpression",operator:"typeof",argument:A()}):t("operator","!")||t("operator","-")||t("operator","+")?{type:"UnaryExpression",operator:o().value,argument:A()}:ye(),ye=()=>{let i=me();for(;;){if(t("operator","++")||t("operator","--")){i={type:"UpdateExpression",operator:o().value,argument:i,prefix:!1};continue}if(t("punct","(")){const l=we();i={type:"CallExpression",callee:i,arguments:l};continue}if(t("punct",".")){o();const l=k();i={type:"MemberExpression",object:i,property:l,computed:!1};continue}if(t("punct","[")){o();const l=g();r("punct","]"),i={type:"MemberExpression",object:i,property:l,computed:!0};continue}break}return i},me=()=>{if(t("identifier","async")){const i=n;if(o(),t("identifier")){const l=k();if(t("operator","=>")){o();const d=t("punct","{")?c():g();return{type:"ArrowFunctionExpression",params:[l],body:d,async:!0}}}else if(t("punct","(")){o();const l=[];let d=!0;try{if(!t("punct",")"))do{if(l.push(S()),!t("punct",","))break;o()}while(!0)}catch{d=!1}if(d&&t("punct",")")&&(o(),t("operator","=>"))){o();const x=t("punct","{")?c():g();return{type:"ArrowFunctionExpression",params:l,body:x,async:!0}}}n=i}if(t("identifier")){const i=k();if(t("operator","=>")){o();const l=t("punct","{")?c():g();return{type:"ArrowFunctionExpression",params:[i],body:l,async:!1}}return i}if(t("punct","(")){const i=n;o();const l=[];let d=!0;try{if(!t("punct",")"))do{if(l.push(S()),!t("punct",","))break;o()}while(!0)}catch{d=!1}if(d&&t("punct",")")&&(o(),t("operator","=>"))){o();const O=t("punct","{")?c():g();return{type:"ArrowFunctionExpression",params:l,body:O,async:!1}}n=i,r("punct","(");const x=g();return r("punct",")"),x}return he()},he=()=>{if(t("number"))return{type:"Literal",value:Number(o().value)};if(t("string"))return{type:"Literal",value:o().value};if(t("keyword","true"))return o(),{type:"Literal",value:!0};if(t("keyword","false"))return o(),{type:"Literal",value:!1};if(t("keyword","null"))return o(),{type:"Literal",value:null};if(t("punct","["))return ge();if(t("punct","{"))return Ee();if(t("identifier"))return k();throw new Error(`Unexpected token ${a().type} ${a().value} at ${a().pos}`)},ge=()=>{r("punct","[");const i=[];if(!t("punct","]"))do{if(t("operator","...")?(o(),i.push({type:"SpreadElement",argument:g()})):i.push(g()),!t("punct",","))break;o()}while(!0);return r("punct","]"),{type:"ArrayExpression",elements:i}},Ee=()=>{r("punct","{");const i=[];if(!t("punct","}"))do{if(t("operator","...")){if(o(),i.push({type:"SpreadElement",argument:g()}),!t("punct",","))break;o();continue}let l,d=!1;if(t("identifier"))l=k();else if(t("string"))l={type:"Literal",value:o().value};else if(t("number"))l={type:"Literal",value:Number(o().value)};else throw new Error(`Expected object key at ${a().pos}`);let x;if(t("operator",":"))o(),x=g();else{if(l.type!=="Identifier")throw new Error(`Expected ':' after key at ${a().pos}`);x=l,d=!0}if(i.push({type:"Property",key:l,value:x,shorthand:d}),!t("punct",","))break;o()}while(!0);return r("punct","}"),{type:"ObjectExpression",properties:i}},we=()=>{r("punct","(");const i=[];if(!t("punct",")"))do{if(t("operator","...")?(o(),i.push({type:"SpreadElement",argument:g()})):i.push(g()),!t("punct",","))break;o()}while(!0);return r("punct",")"),i},k=()=>({type:"Identifier",name:r("identifier").value}),S=()=>{if(t("operator","..."))return o(),{type:"RestElement",argument:S()};if(t("punct","[")){r("punct","[");const i=[];if(!t("punct","]"))do{if(i.push(S()),!t("punct",","))break;o()}while(!0);return r("punct","]"),{type:"ArrayPattern",elements:i}}if(t("punct","{")){r("punct","{");const i=[];if(!t("punct","}"))do{if(t("operator","...")){if(o(),i.push({type:"RestElement",argument:S()}),!t("punct",","))break;o();continue}let l,d=!1;if(t("identifier"))l=k();else if(t("string"))l={type:"Literal",value:o().value};else if(t("number"))l={type:"Literal",value:Number(o().value)};else throw new Error(`Expected object pattern key at ${a().pos}`);let x;if(t("operator",":"))o(),x=S();else{if(l.type!=="Identifier")throw new Error(`Expected ':' after key at ${a().pos}`);x=l,d=!0}if(i.push({type:"Property",key:l,value:x,shorthand:d}),!t("punct",","))break;o()}while(!0);return r("punct","}"),{type:"ObjectPattern",properties:i}}return k()};return m()},We=/^[A-Za-z_$][A-Za-z0-9_$]*$/,qe=new Set(["eval","arguments","this","globalThis","window","document","self","top","parent","frames","process","require","module","exports","__dirname","__filename","importScripts"]),N=e=>{if(!We.test(e))throw new Error(`unsafe identifier in codegen: ${JSON.stringify(e)}`);if(qe.has(e))throw new Error(`forbidden identifier in codegen: ${e}`)},H=e=>e===null?"null":typeof e=="string"?JSON.stringify(e):String(e),h=e=>{switch(e.type){case"Identifier":return N(e.name),e.name;case"SpreadElement":return`...${h(e.argument)}`;case"Literal":return H(e.value);case"ArrayExpression":return`[${e.elements.map(h).join(", ")}]`;case"ObjectExpression":return`{${e.properties.map(s=>s.type==="SpreadElement"?`...${h(s.argument)}`:Ke(s)).join(", ")}}`;case"AwaitExpression":return`(await ${h(e.argument)})`;case"CallExpression":{const s=h(e.callee),n=e.callee.type==="ArrowFunctionExpression";return`${n?"(":""}${s}${n?")":""}(${e.arguments.map(h).join(", ")})`}case"MemberExpression":return e.computed?`${h(e.object)}[${h(e.property)}]`:`${h(e.object)}.${h(e.property)}`;case"AssignmentExpression":return`${h(e.left)} ${e.operator} ${h(e.right)}`;case"UpdateExpression":return e.prefix?`${e.operator}${h(e.argument)}`:`${h(e.argument)}${e.operator}`;case"BinaryExpression":case"LogicalExpression":return`(${h(e.left)} ${e.operator} ${h(e.right)})`;case"UnaryExpression":return e.operator==="typeof"?`(${e.operator} ${h(e.argument)})`:`(${e.operator}${h(e.argument)})`;case"ConditionalExpression":return`(${h(e.test)} ? ${h(e.consequent)} : ${h(e.alternate)})`;case"ArrowFunctionExpression":return Je(e)}},Ke=e=>{const s=e.key.type==="Identifier"?e.key.name:H(e.key.value);return e.shorthand&&e.value.type==="Identifier"&&e.value.name===s?(N(s),s):`${s}: ${h(e.value)}`},Je=e=>{const s=`(${e.params.map(I).join(", ")})`,n=e.async?"async ":"";return e.body.type==="BlockStatement"?`${n}${s} => ${v(e.body,!0)}`:`${n}${s} => { __burn(); return ${h(e.body)}; }`},v=(e,s=!1)=>{const n=s?"__burn();":"",a=o=>o.type==="BlockStatement"?`{__burn();${o.body.map(t=>v(t,s)).join("")}}`:`{__burn();${v(o,s)}}`;switch(e.type){case"BlockStatement":return`{${e.body.map(o=>v(o,s)).join("")}}`;case"ExpressionStatement":return`${n}${h(e.expression)};`;case"IfStatement":{const o=r=>r.type==="BlockStatement"?v(r,s):`{${v(r,s)}}`;return`${n}if (${h(e.test)}) ${o(e.consequent)}${e.alternate?` else ${o(e.alternate)}`:""}`}case"ReturnStatement":return`${n}return${e.argument?` ${h(e.argument)}`:""};`;case"VariableDeclaration":return`${n}${e.kind} ${e.declarations.map(R).join(", ")};`;case"BreakStatement":return`${n}break;`;case"ContinueStatement":return`${n}continue;`;case"WhileStatement":return`${n}while (${h(e.test)}) ${a(e.body)}`;case"ForStatement":{const o=e.init==null?"":Array.isArray(e.init)?`${e.initKind} ${e.init.map(R).join(", ")}`:h(e.init),r=e.test?h(e.test):"",t=e.update?h(e.update):"";return`${n}for (${o}; ${r}; ${t}) ${a(e.body)}`}case"ForInStatement":{const o=Array.isArray(e.left)?`${e.leftKind} ${e.left.map(R).join(", ")}`:h(e.left);return`${n}for (${o} in ${h(e.right)}) ${a(e.body)}`}case"ForOfStatement":{const o=Array.isArray(e.left)?`${e.leftKind} ${e.left.map(R).join(", ")}`:h(e.left);return`${n}for (${o} of ${h(e.right)}) ${a(e.body)}`}}},R=e=>`${I(e.id)}${e.init?` = ${h(e.init)}`:""}`,I=e=>e.type==="Identifier"?(N(e.name),e.name):e.type==="RestElement"?`...${I(e.argument)}`:e.type==="ArrayPattern"?`[${e.elements.map(I).join(", ")}]`:`{${e.properties.map(s=>s.type==="RestElement"?`...${I(s.argument)}`:He(s)).join(", ")}}`,He=e=>{const s=e.key.type==="Identifier"?e.key.name:H(e.key.value);return e.shorthand&&e.key.type==="Identifier"&&e.value.type==="Identifier"&&e.value.name===e.key.name?(N(s),s):`${s}: ${I(e.value)}`},Ze=(e,s)=>{const n=new Set(s),a=[],o=c=>{n.has(c)&&a.push(`reserved identifier: ${c}`)},r=c=>{switch(c.type){case"Identifier":o(c.name);return;case"RestElement":r(c.argument);return;case"ArrayPattern":c.elements.forEach(r);return;case"ObjectPattern":c.properties.forEach(y=>{if(y.type==="RestElement"){r(y.argument);return}r(y.value)});return}},t=c=>{switch(c.type){case"Identifier":o(c.name);return;case"Literal":return;case"SpreadElement":t(c.argument);return;case"ArrayExpression":c.elements.forEach(y=>t(y));return;case"ObjectExpression":c.properties.forEach(y=>{if(y.type==="SpreadElement"){t(y.argument);return}y.shorthand&&y.value.type==="Identifier"&&o(y.value.name),t(y.value)});return;case"AwaitExpression":t(c.argument);return;case"CallExpression":t(c.callee),c.arguments.forEach(y=>t(y));return;case"MemberExpression":t(c.object),c.computed&&t(c.property);return;case"AssignmentExpression":t(c.left),t(c.right);return;case"UpdateExpression":t(c.argument);return;case"BinaryExpression":case"LogicalExpression":t(c.left),t(c.right);return;case"UnaryExpression":t(c.argument);return;case"ConditionalExpression":t(c.test),t(c.consequent),t(c.alternate);return;case"ArrowFunctionExpression":c.params.forEach(r),c.body.type==="BlockStatement"?p(c.body):t(c.body);return}},m=c=>{r(c.id),c.init&&t(c.init)},p=c=>{switch(c.type){case"BlockStatement":c.body.forEach(p);return;case"ExpressionStatement":t(c.expression);return;case"IfStatement":t(c.test),p(c.consequent),c.alternate&&p(c.alternate);return;case"ReturnStatement":c.argument&&t(c.argument);return;case"VariableDeclaration":c.declarations.forEach(m);return;case"WhileStatement":t(c.test),p(c.body);return;case"ForStatement":Array.isArray(c.init)?c.init.forEach(m):c.init&&t(c.init),c.test&&t(c.test),c.update&&t(c.update),p(c.body);return;case"ForInStatement":case"ForOfStatement":Array.isArray(c.left)?c.left.forEach(m):t(c.left),t(c.right),p(c.body);return;case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach(p),a},Ye=(e,s="__fuel")=>{N(s);const n=Ze(e,[s,"__burn"]);if(n.length)throw new Error(n.join(", "));const a=`const __burn = () => { if (--${s}.value < 0) throw new Error("fuel exhausted"); };`,o=e.body.map(r=>v(r,!0)).join("");return`${a}const __run = async () => {${o}}; return __run().then(ok => ({ ok, fuel: ${s}.value })).catch(err => ({ err: String(err), fuel: ${s}.value }));`},Xe=(()=>{const e=Object.create(null);return e.keys=s=>Object.keys(s),e.values=s=>Object.values(s),e.entries=s=>Object.entries(s),Object.freeze(e)})(),Ge=e=>{if(e.some(t=>typeof t!="string"))throw new Error("Function arguments must be strings");const s=e,n=s.length?s[s.length-1]:"",a=s.slice(0,-1),o=[];for(const t of a)for(const m of t.split(",")){const p=m.trim();if(!p)continue;const c=p.startsWith("..."),y=c?p.slice(3):p;if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(y))throw new Error(`Invalid function parameter: ${p}`);o.push({name:y,rest:c})}const r=o.filter(t=>t.rest).length;if(r>1||r===1&&!o[o.length-1].rest)throw new Error("Rest parameter must be the last parameter");return{params:o,body:n}},Qe=(e,s)=>{const n={};let a=0;for(const o of e)o.rest?(n[o.name]=s.slice(a),a=s.length):n[o.name]=s[a++];return n},et=(e,s)=>(...n)=>{const{params:a,body:o}=Ge(n);return async(...r)=>{const t={...s,...Qe(a,r)},m=await pe(o,e,t);if("err"in m)throw new Error(m.err);return m.ok}},tt=(e,s,n)=>{const a={...e,Object:Xe,Promise};return{...a,Function:et(s,a)}},rt=e=>{if(e instanceof Error){const s=e.stack||"",n=`${e.name}: ${e.message}`,a=s.replace(/^[^\n]*\n?/,"").replace(/spacetimedb_module:(\d+):(\d+)/g,"<bundled:$1:$2>");return a?`${n}
${a}`:n}if(typeof e=="object"&&e!==null)try{return JSON.stringify(e)}catch{return String(e)}return String(e)},pe=async(e,s,n={},a="__fuel")=>{try{const o=tt(n,s,"async"),r=ze(e);if(Ve(r).length)return{err:"prototype access",fuel:s.value};const m=Ue(r,[...Object.keys(o),a]);if(m.length)return{err:m.join(", "),fuel:s.value};const p=Ye(r,a),c={...o,[a]:s};return await new Function(...Object.keys(c),p)(...Object.values(c))}catch(o){return{err:rt(o),fuel:s.value}}},ae=(e,s)=>`${e}|${C(s)}`,nt=e=>{const s={value:e.fuel??1e5},n=new Map,a=async(o,r)=>{const t=await P(o),m=await P(r),p=await B(t);if(typeof p!="string")throw new Error("function note must resolve to a string");const c=await B(m),y={get:E=>{const u=ae(t,E);return n.get(u)},set:(E,u)=>{const w=ae(t,E);return n.set(w,u),u}},f=async(E,u)=>Ne(E,u===void 0?null:u),$=await pe(p,s,{...e.env??{},arg:c,argRef:m,call:a,callNote:a,remote:f,store:y,addNote:ue,getNote:le,asRef:P,deref:B,hashData:C,fromjson:T,HTML:Oe});if("err"in $)throw new Error($.err);return $.ok};return a},ot=async(e,s,n={})=>{const o=await nt(n)(e,s===void 0?null:s);if(typeof o!="function")throw new Error("view function must return (upper) => VDom");return o},at=e=>{const s=e.replace(/^\/+/,"").split("/")[0];if(!s)return null;const n=decodeURIComponent(s).trim();return n?D(n)?n:/^[a-f0-9]{32}$/i.test(n)?`#${n}`:null:null},st=async()=>{const e=document.getElementById("app")??document.body,s=at(window.location.pathname);if(!s){e.innerHTML="",e.textContent="Open /<note-hash> to render that note as a view.";return}try{const n=await ot(s,{}),a=Se(n);e.innerHTML="",e.append(a)}catch(n){e.innerHTML=`<pre>Failed to render note ${s} on server ${Ce()}: ${String(n)}</pre>`}};st().catch(e=>{console.error(e);const s=document.getElementById("app")??document.body;s.textContent=`App boot failed: ${String(e)}`});
