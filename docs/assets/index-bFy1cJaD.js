(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const t of n.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&a(t)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const Se=["click","mousemove","mouseup","mousedown","drag","wheel"],ve=["keydown","keyup"],le="http://www.w3.org/2000/svg",Ae=new Set(["svg","path","g","line","polyline","polygon","circle","ellipse","rect","text"]),je=new Set(["viewBox","width","height","xmlns","d","fill","stroke","stroke-width","stroke-linecap","stroke-linejoin","stroke-dasharray","stroke-dashoffset","x","y","x1","y1","x2","y2","cx","cy","r","rx","ry","points","transform","opacity","font-size","font-family","font-weight","text-anchor","dominant-baseline","dx","dy"]);let B=new WeakMap,O=new WeakMap;const Ie=e=>{const s=o=>{const a=Ae.has(o.tag)?document.createElementNS(le,o.tag):document.createElement(o.tag);return a.textContent=o.textContent,(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&o.value&&(a.value=o.value),O.set(o,a),B.set(a,o),a.append(...o.children.map(r=>s(r))),Object.entries(o.attrs).forEach(([r,n])=>{je.has(r)&&a.setAttribute(r,n)}),Object.entries(o.style).forEach(r=>a.style.setProperty(...r)),Se.forEach(r=>a.addEventListener(r,n=>{const t=n;o.onEvent!=null&&o.onEvent({type:r,target:B.get(n.target),clientX:t.clientX,clientY:t.clientY,deltaY:r==="wheel"?t.deltaY:void 0,currentTarget:a,preventDefault:()=>n.preventDefault()})})),ve.forEach(r=>a.addEventListener(r,n=>{let{key:t,metaKey:d,shiftKey:p}=n;["INPUT","TEXTAREA"].includes(n.target.tagName)&&(o.value=n.target.value),o.onEvent!=null&&o.onEvent({type:r,key:t,metaKey:d,shiftKey:p,target:B.get(n.target)})})),a};return s(e({add:(o,...a)=>{var r;(r=O.get(o))==null||r.append(...a.map(n=>s(n)))},del:o=>{var a;B.delete(O.get(o)),(a=O.get(o))==null||a.remove(),O.delete(o)},update:o=>{let a=O.get(o);a.replaceWith(s(o)),B.delete(a)}}))},$=e=>(...s)=>{let o=new Map,a={tag:e,style:{},attrs:{},textContent:"",id:"",children:[],onEvent:n=>{let t=o.get(n.type);if(t)return t(n)}},r=n=>{if(n instanceof Array)n.forEach(r);else if(typeof n=="string")a.textContent=n;else if(n instanceof Object){if("tag"in n)return a.children.push(n);"id"in n&&(a.id=n.id),"value"in n&&(a.value=n.value),"attrs"in n&&Object.entries(n.attrs).forEach(([t,d])=>a.attrs[t]=d),"style"in n&&Object.entries(n.style).forEach(t=>a.style[t[0].replace(/([A-Z])/g,"-$1")]=t[1]),Object.entries(n).forEach(([t,d])=>{t.startsWith("on")&&o.set(t.slice(2),d)})}};return r(s),a};let H=$("div"),_e=$("svg"),Oe=$("path"),Fe=$("text");const Le=(...e)=>{const s=H({style:{background:"var(--background-color)",color:"var(--color)",padding:"1em",paddingBottom:"2em",borderRadius:"1em",zIndex:"2000",overflowY:"scroll"}},...e);return H({style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(166, 166, 166, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2000"}},s)},Pe={div:H,span:$("span"),p:$("p"),h1:$("h1"),h2:$("h2"),h3:$("h3"),h4:$("h4"),h5:$("h5"),h6:$("h6"),a:$("a"),button:$("button"),input:$("input"),textarea:$("textarea"),pre:$("pre"),svgPath:(e,s={},...o)=>{const a=e instanceof Array?e:[e],{viewBox:r="0 0 24 24",width:n="1em",height:t="1em",fill:d="currentColor",stroke:p,strokeWidth:h}=s,m={fill:d};return p&&(m.stroke=p),h&&(m["stroke-width"]=h),_e({attrs:{viewBox:r,width:n,height:t,xmlns:le}},...a.map(l=>Oe({attrs:{...m,d:l}})),...o)},svgText:(e,s={})=>{const o={};return s.x&&(o.x=s.x),s.y&&(o.y=s.y),s.fill&&(o.fill=s.fill),s.background&&(o.background=s.background),s.fontSize&&(o["font-size"]=s.fontSize),s.fontFamily&&(o["font-family"]=s.fontFamily),s.fontWeight&&(o["font-weight"]=s.fontWeight),s.textAnchor&&(o["text-anchor"]=s.textAnchor),s.dominantBaseline&&(o["dominant-baseline"]=s.dominantBaseline),s.dx&&(o.dx=s.dx),s.dy&&(o.dy=s.dy),Fe({attrs:o},e)},popup:Le},Be=0xcbf29ce484222325n,Ce=0x84222325cbf29ce4n,Ne=0x100000001b3n,Re=(1n<<64n)-1n,ie=(e,s)=>{let o=s;for(let a=0;a<e.length;a+=1)o^=BigInt(e.charCodeAt(a)),o=o*Ne&Re;return o},ce=e=>e.toString(16).padStart(16,"0"),q=(...e)=>{const s=JSON.stringify(e),o=ie(s,Be),a=ie(s,Ce);return`#${ce(o)}${ce(a)}`},Z=e=>JSON.stringify(e,null,2),z=e=>JSON.parse(e),W=e=>typeof e=="string"&&/^#([a-f0-9]{32})$/i.test(e),T=e=>{if(W(e))return e;if(["string","number","boolean"].includes(typeof e)||e===null)return q(Z(e));if(Array.isArray(e))return q("arr",e.map(T));if(typeof e=="object"){const s=Object.entries(e).sort(([o],[a])=>o<a?-1:o>a?1:0).map(([o,a])=>[o,T(a)]);return q(Z(Object.fromEntries(s)))}throw new Error(`unsupported type for hashing: ${typeof e}`)},Te="hashnotes",pe={local:"http://localhost:3000",maincloud:"https://maincloud.spacetimedb.com"},E=typeof localStorage<"u"?localStorage:null,V=e=>`access_token:${e}`,Me=()=>(E==null?void 0:E.getItem("db_preset"))==="local"?"local":"maincloud";let I=Me(),Y=pe[I],S=(E==null?void 0:E.getItem(V(I)))??null;const fe={value:I,get:()=>I,set:async e=>(I=e,fe.value=e,Y=pe[e],E==null||E.setItem("db_preset",e),S=(E==null?void 0:E.getItem(V(e)))??null,e)},X=async(e,s)=>{var r;if(S||(S=(E==null?void 0:E.getItem(V(I)))??null),S||(S=((r=await(await fetch(`${Y}/v1/identity`,{method:"POST",headers:{"Content-Type":"application/json"}})).json())==null?void 0:r.token)||null,S&&(E==null||E.setItem(V(I),S))),typeof fetch>"u")throw new Error("fetch is not available");const o=await fetch(`${Y}/v1/database/${Te}/call/${e}`,{method:"POST",headers:{"Content-Type":"application/json",...S?{Authorization:`Bearer ${S}`}:{}},body:JSON.stringify(s)}),a=await o.text();if(!o.ok)throw new Error(a);return a},C=new Map,U=new Map,K=new Map,de=async(e,s={})=>{const{skipCache:o=!1}=s,a=T(e);if(!o){if(C.get(a)!==void 0)return a;const t=U.get(a);if(t)return t}const r=(async()=>(await X("add_note",{data:Z(e)}),o||C.set(a,e),a))();o||U.set(a,r);try{return await r}finally{o||U.delete(a)}},ye=async(e,s={})=>{const{skipCache:o=!1}=s;if(!o){const r=C.get(e);if(r!==void 0)return r;const n=U.get(e);if(n)try{await n;const d=C.get(e);if(d!==void 0)return d}catch{}const t=K.get(e);if(t)return t}const a=(async()=>{const r=await X("get_note",{hash:e}),n=z(z(r));return o||C.set(e,n),n})();o||K.set(e,a);try{return await a}finally{o||K.delete(e)}},N=async e=>W(e)?ye(e).then(N):e,R=async e=>W(e)?e:de(e),De=async(e,s)=>{const o=await R(e),a=await R(s===void 0?null:s);return await X("call_note",{fn:o,arg:a}).then(z).then(N)},Ue=new Set(["if","else","return","await","typeof","let","const","for","while","in","of","break","continue","true","false","null"]),ze=e=>/[A-Za-z_$]/.test(e),Ve=e=>/[A-Za-z0-9_$]/.test(e),J=e=>/[0-9]/.test(e),We=e=>{const s=[];let o=0;const a=(t,d,p)=>s.push({type:t,value:d,pos:p}),r=()=>e[o],n=()=>e[o++];for(;o<e.length;){const t=r();if(t===" "||t===`
`||t==="\r"||t==="	"){o++;continue}if(t==="/"&&e[o+1]==="/"){for(o+=2;o<e.length&&e[o]!==`
`;)o++;continue}if(t==="/"&&e[o+1]==="*"){for(o+=2;o<e.length&&!(e[o]==="*"&&e[o+1]==="/");)o++;o+=2;continue}if(t==="'"||t==='"'){const m=n();let l="";const k=o-1;for(;o<e.length;){const w=n();if(w==="\\"){const c=n();l+=c}else{if(w===m)break;l+=w}}a("string",l,k);continue}if(J(t)){const m=o;let l="";for(;o<e.length&&J(r());)l+=n();if(r()===".")for(l+=n();o<e.length&&J(r());)l+=n();a("number",l,m);continue}if(ze(t)){const m=o;let l="";for(;o<e.length&&Ve(r());)l+=n();Ue.has(l)?a("keyword",l,m):a("identifier",l,m);continue}const d=o,p=e.slice(o,o+2),h=e.slice(o,o+3);if(h==="==="||h==="!=="||h==="..."){o+=3,a("operator",h,d);continue}if(p==="&&"||p==="||"||p==="=="||p==="!="||p==="<="||p===">="||p==="=>"||p==="+="||p==="-="||p==="*="||p==="/="||p==="%="||p==="++"||p==="--"){o+=2,a("operator",p,d);continue}if("+-*/%<>=!.,;:?(){}[]".includes(t)){o++;const m=".;,(){}[]".includes(t)?"punct":"operator";a(m,t,d);continue}throw new Error(`Unexpected character '${t}' at ${o}`)}return s.push({type:"eof",value:"",pos:o}),s},qe=(e,s=[])=>{const o=[],a=new Set(s),r=[new Set],n=c=>r[r.length-1].add(c),t=c=>r.some(b=>b.has(c))||a.has(c),d=()=>r.push(new Set),p=()=>{r.pop()},h=c=>{t(c)||o.push(`undeclared: ${c}`)},m=c=>{c.type==="Identifier"?n(c.name):c.type==="RestElement"?m(c.argument):c.type==="ArrayPattern"?c.elements.forEach(m):c.properties.forEach(b=>{b.type==="RestElement"?m(b.argument):m(b.value)})},l=c=>{switch(c.type){case"Identifier":h(c.name);return;case"Literal":return;case"SpreadElement":l(c.argument);return;case"ArrayExpression":c.elements.forEach(b=>l(b));return;case"ObjectExpression":c.properties.forEach(b=>{b.type==="SpreadElement"?l(b.argument):l(b.value)});return;case"AwaitExpression":l(c.argument);return;case"CallExpression":l(c.callee),c.arguments.forEach(b=>l(b));return;case"MemberExpression":l(c.object),c.computed&&l(c.property);return;case"AssignmentExpression":l(c.left),l(c.right);return;case"UpdateExpression":l(c.argument);return;case"BinaryExpression":case"LogicalExpression":l(c.left),l(c.right);return;case"UnaryExpression":l(c.argument);return;case"ConditionalExpression":l(c.test),l(c.consequent),l(c.alternate);return;case"ArrowFunctionExpression":d(),c.params.forEach(m),c.body.type==="BlockStatement"?w(c.body):l(c.body),p();return}},k=c=>{m(c.id),c.init&&l(c.init)},w=c=>{switch(c.type){case"BlockStatement":d(),c.body.forEach(w),p();return;case"ExpressionStatement":l(c.expression);return;case"IfStatement":l(c.test),w(c.consequent),c.alternate&&w(c.alternate);return;case"ReturnStatement":c.argument&&l(c.argument);return;case"VariableDeclaration":c.declarations.forEach(k);return;case"WhileStatement":l(c.test),w(c.body);return;case"ForStatement":{d(),Array.isArray(c.init)?c.init.forEach(k):c.init&&l(c.init),c.test&&l(c.test),c.update&&l(c.update),w(c.body),p();return}case"ForInStatement":case"ForOfStatement":{d(),Array.isArray(c.left)?c.left.forEach(k):l(c.left),l(c.right),w(c.body),p();return}case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach(w),o},Ke=e=>{const s=[],o=new Set(["prototype","constructor","__proto__"]),a=n=>{switch(n.type){case"MemberExpression":!n.computed&&n.property.type==="Identifier"&&o.has(n.property.name)&&s.push("prototype access"),n.computed&&!(n.property.type==="Literal"&&typeof n.property.value=="number")&&s.push("only numeric literal indexing allowed"),a(n.object),n.computed&&a(n.property);return;case"SpreadElement":a(n.argument);return;case"CallExpression":a(n.callee),n.arguments.forEach(t=>a(t));return;case"AwaitExpression":a(n.argument);return;case"ArrayExpression":n.elements.forEach(t=>a(t));return;case"ObjectExpression":n.properties.forEach(t=>{t.type==="SpreadElement"?a(t.argument):a(t.value)});return;case"AssignmentExpression":a(n.left),a(n.right);return;case"UpdateExpression":a(n.argument);return;case"BinaryExpression":case"LogicalExpression":a(n.left),a(n.right);return;case"UnaryExpression":a(n.argument);return;case"ConditionalExpression":a(n.test),a(n.consequent),a(n.alternate);return;case"ArrowFunctionExpression":n.body.type==="BlockStatement"?r(n.body):a(n.body);return;case"Identifier":case"Literal":return}},r=n=>{switch(n.type){case"BlockStatement":n.body.forEach(r);return;case"ExpressionStatement":a(n.expression);return;case"IfStatement":a(n.test),r(n.consequent),n.alternate&&r(n.alternate);return;case"ReturnStatement":n.argument&&a(n.argument);return;case"VariableDeclaration":n.declarations.forEach(t=>t.init&&a(t.init));return;case"WhileStatement":a(n.test),r(n.body);return;case"ForStatement":Array.isArray(n.init)?n.init.forEach(t=>t.init&&a(t.init)):n.init&&a(n.init),n.test&&a(n.test),n.update&&a(n.update),r(n.body);return;case"ForInStatement":case"ForOfStatement":Array.isArray(n.left)?n.left.forEach(t=>t.init&&a(t.init)):a(n.left),a(n.right),r(n.body);return;case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach(r),s},Je=e=>{const s=We(e);let o=0;const a=()=>s[o],r=()=>s[o++],n=(i,u)=>{const f=a();if(f.type!==i||u!==void 0&&f.value!==u)throw new Error(`Expected ${u??i} at ${f.pos}`);return r()},t=(i,u)=>{const f=a();return f.type===i&&(u===void 0||f.value===u)},d=()=>{const i=[];for(;!t("eof");)i.push(p());return{type:"Program",body:i}},p=()=>{if(t("punct","{"))return h();if(t("keyword","if"))return m();if(t("keyword","while"))return c();if(t("keyword","for"))return b();if(t("keyword","break"))return r(),t("punct",";")&&r(),{type:"BreakStatement"};if(t("keyword","continue"))return r(),t("punct",";")&&r(),{type:"ContinueStatement"};if(t("keyword","return"))return l();if(t("keyword","let")||t("keyword","const"))return w();const i=g();return t("punct",";")&&r(),{type:"ExpressionStatement",expression:i}},h=()=>{n("punct","{");const i=[];for(;!t("punct","}");)i.push(p());return n("punct","}"),{type:"BlockStatement",body:i}},m=()=>{n("keyword","if"),n("punct","(");const i=g();n("punct",")");const u=p(),f=t("keyword","else")?(r(),p()):null;return{type:"IfStatement",test:i,consequent:u,alternate:f}},l=()=>{if(n("keyword","return"),t("punct",";"))return r(),{type:"ReturnStatement",argument:null};const i=t("punct","}")?null:g();return t("punct",";")&&r(),{type:"ReturnStatement",argument:i}},k=i=>{const u=r().value,f=[];do{const x=A(),L=t("operator","=")?(r(),g()):null;if(f.push({type:"VariableDeclarator",id:x,init:L}),!t("punct",","))break;r()}while(!0);return i&&t("punct",";")&&r(),{kind:u,declarations:f}},w=()=>{const{kind:i,declarations:u}=k(!0);return{type:"VariableDeclaration",kind:i,declarations:u}},c=()=>{n("keyword","while"),n("punct","(");const i=g();n("punct",")");const u=p();return{type:"WhileStatement",test:i,body:u}},b=()=>{n("keyword","for"),n("punct","(");let i=null,u=null;if(!t("punct",";"))if(t("keyword","let")||t("keyword","const")){const P=k(!1);i=P.declarations,u=P.kind}else i=g();if(t("keyword","in")||t("keyword","of")){const P=r().value,ae=g();n("punct",")");const se=p();if(!i)throw new Error(`Expected initializer before ${P} at ${a().pos}`);return P==="in"?{type:"ForInStatement",left:i,leftKind:u,right:ae,body:se}:{type:"ForOfStatement",left:i,leftKind:u,right:ae,body:se}}n("punct",";");const f=t("punct",";")?null:g();n("punct",";");const x=t("punct",")")?null:g();n("punct",")");const L=p();return{type:"ForStatement",init:i,initKind:u,test:f,update:x,body:L}},g=()=>Q(),Q=()=>{const i=he();if(t("operator","=")||t("operator","+=")||t("operator","-=")||t("operator","*=")||t("operator","/=")||t("operator","%=")){const u=r().value,f=Q();return{type:"AssignmentExpression",operator:u,left:i,right:f}}return i},he=()=>{let i=ge();if(t("operator","?")){r();const u=g();n("operator",":");const f=g();return{type:"ConditionalExpression",test:i,consequent:u,alternate:f}}return i},ge=()=>{let i=ee();for(;t("operator","||");){const u=r().value,f=ee();i={type:"LogicalExpression",operator:u,left:i,right:f}}return i},ee=()=>{let i=te();for(;t("operator","&&");){const u=r().value,f=te();i={type:"LogicalExpression",operator:u,left:i,right:f}}return i},te=()=>{let i=re();for(;t("operator","==")||t("operator","!=")||t("operator","===")||t("operator","!==");){const u=r().value,f=re();i={type:"BinaryExpression",operator:u,left:i,right:f}}return i},re=()=>{let i=ne();for(;t("operator","<")||t("operator","<=")||t("operator",">")||t("operator",">=");){const u=r().value,f=ne();i={type:"BinaryExpression",operator:u,left:i,right:f}}return i},ne=()=>{let i=oe();for(;t("operator","+")||t("operator","-");){const u=r().value,f=oe();i={type:"BinaryExpression",operator:u,left:i,right:f}}return i},oe=()=>{let i=_();for(;t("operator","*")||t("operator","/")||t("operator","%");){const u=r().value,f=_();i={type:"BinaryExpression",operator:u,left:i,right:f}}return i},_=()=>t("keyword","await")?(r(),{type:"AwaitExpression",argument:_()}):t("operator","++")||t("operator","--")?{type:"UpdateExpression",operator:r().value,argument:_(),prefix:!0}:t("keyword","typeof")?(r(),{type:"UnaryExpression",operator:"typeof",argument:_()}):t("operator","!")||t("operator","-")||t("operator","+")?{type:"UnaryExpression",operator:r().value,argument:_()}:we(),we=()=>{let i=Ee();for(;;){if(t("operator","++")||t("operator","--")){i={type:"UpdateExpression",operator:r().value,argument:i,prefix:!1};continue}if(t("punct","(")){const u=ke();i={type:"CallExpression",callee:i,arguments:u};continue}if(t("punct",".")){r();const u=v();i={type:"MemberExpression",object:i,property:u,computed:!1};continue}if(t("punct","[")){r();const u=g();n("punct","]"),i={type:"MemberExpression",object:i,property:u,computed:!0};continue}break}return i},Ee=()=>{if(t("identifier","async")){const i=o;if(r(),t("identifier")){const u=v();if(t("operator","=>")){r();const f=t("punct","{")?h():g();return{type:"ArrowFunctionExpression",params:[u],body:f,async:!0}}}else if(t("punct","(")){r();const u=[];let f=!0;try{if(!t("punct",")"))do{if(u.push(A()),!t("punct",","))break;r()}while(!0)}catch{f=!1}if(f&&t("punct",")")&&(r(),t("operator","=>"))){r();const x=t("punct","{")?h():g();return{type:"ArrowFunctionExpression",params:u,body:x,async:!0}}}o=i}if(t("identifier")){const i=v();if(t("operator","=>")){r();const u=t("punct","{")?h():g();return{type:"ArrowFunctionExpression",params:[i],body:u,async:!1}}return i}if(t("punct","(")){const i=o;r();const u=[];let f=!0;try{if(!t("punct",")"))do{if(u.push(A()),!t("punct",","))break;r()}while(!0)}catch{f=!1}if(f&&t("punct",")")&&(r(),t("operator","=>"))){r();const L=t("punct","{")?h():g();return{type:"ArrowFunctionExpression",params:u,body:L,async:!1}}o=i,n("punct","(");const x=g();return n("punct",")"),x}return be()},be=()=>{if(t("number"))return{type:"Literal",value:Number(r().value)};if(t("string"))return{type:"Literal",value:r().value};if(t("keyword","true"))return r(),{type:"Literal",value:!0};if(t("keyword","false"))return r(),{type:"Literal",value:!1};if(t("keyword","null"))return r(),{type:"Literal",value:null};if(t("punct","["))return $e();if(t("punct","{"))return xe();if(t("identifier"))return v();throw new Error(`Unexpected token ${a().type} ${a().value} at ${a().pos}`)},$e=()=>{n("punct","[");const i=[];if(!t("punct","]"))do{if(t("operator","...")?(r(),i.push({type:"SpreadElement",argument:g()})):i.push(g()),!t("punct",","))break;r()}while(!0);return n("punct","]"),{type:"ArrayExpression",elements:i}},xe=()=>{n("punct","{");const i=[];if(!t("punct","}"))do{if(t("operator","...")){if(r(),i.push({type:"SpreadElement",argument:g()}),!t("punct",","))break;r();continue}let u,f=!1;if(t("identifier"))u=v();else if(t("string"))u={type:"Literal",value:r().value};else if(t("number"))u={type:"Literal",value:Number(r().value)};else throw new Error(`Expected object key at ${a().pos}`);let x;if(t("operator",":"))r(),x=g();else{if(u.type!=="Identifier")throw new Error(`Expected ':' after key at ${a().pos}`);x=u,f=!0}if(i.push({type:"Property",key:u,value:x,shorthand:f}),!t("punct",","))break;r()}while(!0);return n("punct","}"),{type:"ObjectExpression",properties:i}},ke=()=>{n("punct","(");const i=[];if(!t("punct",")"))do{if(t("operator","...")?(r(),i.push({type:"SpreadElement",argument:g()})):i.push(g()),!t("punct",","))break;r()}while(!0);return n("punct",")"),i},v=()=>({type:"Identifier",name:n("identifier").value}),A=()=>{if(t("operator","..."))return r(),{type:"RestElement",argument:A()};if(t("punct","[")){n("punct","[");const i=[];if(!t("punct","]"))do{if(i.push(A()),!t("punct",","))break;r()}while(!0);return n("punct","]"),{type:"ArrayPattern",elements:i}}if(t("punct","{")){n("punct","{");const i=[];if(!t("punct","}"))do{if(t("operator","...")){if(r(),i.push({type:"RestElement",argument:A()}),!t("punct",","))break;r();continue}let u,f=!1;if(t("identifier"))u=v();else if(t("string"))u={type:"Literal",value:r().value};else if(t("number"))u={type:"Literal",value:Number(r().value)};else throw new Error(`Expected object pattern key at ${a().pos}`);let x;if(t("operator",":"))r(),x=A();else{if(u.type!=="Identifier")throw new Error(`Expected ':' after key at ${a().pos}`);x=u,f=!0}if(i.push({type:"Property",key:u,value:x,shorthand:f}),!t("punct",","))break;r()}while(!0);return n("punct","}"),{type:"ObjectPattern",properties:i}}return v()};return d()},He=/^[A-Za-z_$][A-Za-z0-9_$]*$/,Ze=new Set(["eval","arguments","this","globalThis","window","document","self","top","parent","frames","process","require","module","exports","__dirname","__filename","importScripts"]),M=e=>{if(!He.test(e))throw new Error(`unsafe identifier in codegen: ${JSON.stringify(e)}`);if(Ze.has(e))throw new Error(`forbidden identifier in codegen: ${e}`)},G=e=>e===null?"null":typeof e=="string"?JSON.stringify(e):String(e),y=e=>{switch(e.type){case"Identifier":return M(e.name),e.name;case"SpreadElement":return`...${y(e.argument)}`;case"Literal":return G(e.value);case"ArrayExpression":return`[${e.elements.map(y).join(", ")}]`;case"ObjectExpression":return`{${e.properties.map(s=>s.type==="SpreadElement"?`...${y(s.argument)}`:Ye(s)).join(", ")}}`;case"AwaitExpression":return`(await ${y(e.argument)})`;case"CallExpression":{const s=y(e.callee),o=e.callee.type==="ArrowFunctionExpression";return`${o?"(":""}${s}${o?")":""}(${e.arguments.map(y).join(", ")})`}case"MemberExpression":return e.computed?`${y(e.object)}[${y(e.property)}]`:`${y(e.object)}.${y(e.property)}`;case"AssignmentExpression":return`${y(e.left)} ${e.operator} ${y(e.right)}`;case"UpdateExpression":return e.prefix?`${e.operator}${y(e.argument)}`:`${y(e.argument)}${e.operator}`;case"BinaryExpression":case"LogicalExpression":return`(${y(e.left)} ${e.operator} ${y(e.right)})`;case"UnaryExpression":return e.operator==="typeof"?`(${e.operator} ${y(e.argument)})`:`(${e.operator}${y(e.argument)})`;case"ConditionalExpression":return`(${y(e.test)} ? ${y(e.consequent)} : ${y(e.alternate)})`;case"ArrowFunctionExpression":return Xe(e)}},Ye=e=>{const s=e.key.type==="Identifier"?e.key.name:G(e.key.value);return e.shorthand&&e.value.type==="Identifier"&&e.value.name===s?(M(s),s):`${s}: ${y(e.value)}`},Xe=e=>{const s=`(${e.params.map(F).join(", ")})`,o=e.async?"async ":"";return e.body.type==="BlockStatement"?`${o}${s} => ${j(e.body,!0)}`:`${o}${s} => { __burn(); return ${y(e.body)}; }`},j=(e,s=!1)=>{const o=s?"__burn();":"",a=r=>r.type==="BlockStatement"?`{__burn();${r.body.map(t=>j(t,s)).join("")}}`:`{__burn();${j(r,s)}}`;switch(e.type){case"BlockStatement":return`{${e.body.map(r=>j(r,s)).join("")}}`;case"ExpressionStatement":return`${o}${y(e.expression)};`;case"IfStatement":{const r=n=>n.type==="BlockStatement"?j(n,s):`{${j(n,s)}}`;return`${o}if (${y(e.test)}) ${r(e.consequent)}${e.alternate?` else ${r(e.alternate)}`:""}`}case"ReturnStatement":return`${o}return${e.argument?` ${y(e.argument)}`:""};`;case"VariableDeclaration":return`${o}${e.kind} ${e.declarations.map(D).join(", ")};`;case"BreakStatement":return`${o}break;`;case"ContinueStatement":return`${o}continue;`;case"WhileStatement":return`${o}while (${y(e.test)}) ${a(e.body)}`;case"ForStatement":{const r=e.init==null?"":Array.isArray(e.init)?`${e.initKind} ${e.init.map(D).join(", ")}`:y(e.init),n=e.test?y(e.test):"",t=e.update?y(e.update):"";return`${o}for (${r}; ${n}; ${t}) ${a(e.body)}`}case"ForInStatement":{const r=Array.isArray(e.left)?`${e.leftKind} ${e.left.map(D).join(", ")}`:y(e.left);return`${o}for (${r} in ${y(e.right)}) ${a(e.body)}`}case"ForOfStatement":{const r=Array.isArray(e.left)?`${e.leftKind} ${e.left.map(D).join(", ")}`:y(e.left);return`${o}for (${r} of ${y(e.right)}) ${a(e.body)}`}}},D=e=>`${F(e.id)}${e.init?` = ${y(e.init)}`:""}`,F=e=>e.type==="Identifier"?(M(e.name),e.name):e.type==="RestElement"?`...${F(e.argument)}`:e.type==="ArrayPattern"?`[${e.elements.map(F).join(", ")}]`:`{${e.properties.map(s=>s.type==="RestElement"?`...${F(s.argument)}`:Ge(s)).join(", ")}}`,Ge=e=>{const s=e.key.type==="Identifier"?e.key.name:G(e.key.value);return e.shorthand&&e.key.type==="Identifier"&&e.value.type==="Identifier"&&e.value.name===e.key.name?(M(s),s):`${s}: ${F(e.value)}`},Qe=(e,s="__fuel")=>{M(s);const o=`const __burn = () => { if (--${s}.value < 0) throw new Error("fuel exhausted"); };`,a=e.body.map(r=>j(r,!0)).join("");return`${o}const __run = async () => {${a}}; return __run().then(ok => ({ ok, fuel: ${s}.value })).catch(err => ({ err: String(err), fuel: ${s}.value }));`},et=(()=>{const e=Object.create(null);return e.keys=s=>Object.keys(s),e.values=s=>Object.values(s),e.entries=s=>Object.entries(s),Object.freeze(e)})(),tt=e=>{if(e.some(t=>typeof t!="string"))throw new Error("Function arguments must be strings");const s=e,o=s.length?s[s.length-1]:"",a=s.slice(0,-1),r=[];for(const t of a)for(const d of t.split(",")){const p=d.trim();if(!p)continue;const h=p.startsWith("..."),m=h?p.slice(3):p;if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(m))throw new Error(`Invalid function parameter: ${p}`);r.push({name:m,rest:h})}const n=r.filter(t=>t.rest).length;if(n>1||n===1&&!r[r.length-1].rest)throw new Error("Rest parameter must be the last parameter");return{params:r,body:o}},rt=(e,s)=>{const o={};let a=0;for(const r of e)r.rest?(o[r.name]=s.slice(a),a=s.length):o[r.name]=s[a++];return o},nt=(e,s)=>(...o)=>{const{params:a,body:r}=tt(o);return async(...n)=>{const t={...s,...rt(a,n)},d=await me(r,e,t);if("err"in d)throw new Error(d.err);return d.ok}},ot=(e,s,o)=>{const a={...e,Object:et,Promise};return{...a,Function:nt(s,a)}},at=e=>{if(e instanceof Error){const s=e.stack||"",o=`${e.name}: ${e.message}`,a=s.replace(/^[^\n]*\n?/,"").replace(/spacetimedb_module:(\d+):(\d+)/g,"<bundled:$1:$2>");return a?`${o}
${a}`:o}if(typeof e=="object"&&e!==null)try{return JSON.stringify(e)}catch{return String(e)}return String(e)},me=async(e,s,o={},a="__fuel")=>{try{const r=ot(o,s,"async"),n=Je(e);if(Ke(n).length)return{err:"prototype access",fuel:s.value};const d=qe(n,[...Object.keys(r),a]);if(d.length)return{err:d.join(", "),fuel:s.value};const p=Qe(n,a),h={...r,[a]:s};return await new Function(...Object.keys(h),p)(...Object.values(h))}catch(r){return{err:at(r),fuel:s.value}}},ue=(e,s)=>`${e}|${T(s)}`,st=e=>{const s={value:e.fuel??1e5},o=new Map,a=async(r,n)=>{const t=await R(r),d=await R(n),p=await N(t);if(typeof p!="string")throw new Error("function note must resolve to a string");const h=await N(d),m={get:w=>{const c=ue(t,w);return o.get(c)},set:(w,c)=>{const b=ue(t,w);return o.set(b,c),c}},l=async(w,c)=>De(w,c===void 0?null:c),k=await me(p,s,{...e.env??{},arg:h,argRef:d,call:a,callNote:a,remote:l,store:m,addNote:de,getNote:ye,asRef:R,deref:N,hashData:T,fromjson:z,HTML:Pe});if("err"in k)throw new Error(k.err);return k.ok};return a},it=async(e,s,o={})=>{const r=await st(o)(e,s===void 0?null:s);if(typeof r!="function")throw new Error("view function must return (upper) => VDom");return r},ct=e=>{const s=e.replace(/^\/+/,"").split("/")[0];if(!s)return null;const o=decodeURIComponent(s).trim();return o?W(o)?o:/^[a-f0-9]{32}$/i.test(o)?`#${o}`:null:null},ut=async()=>{const e=document.getElementById("app")??document.body,s=ct(window.location.pathname);if(!s){e.innerHTML="",e.textContent="Open /<note-hash> to render that note as a view.";return}try{const o=await it(s,{}),a=Ie(o);e.innerHTML="",e.append(a)}catch(o){e.innerHTML=`<pre>Failed to render note ${s} on server ${fe.get()}: ${String(o)}</pre>`}};ut().catch(e=>{console.error(e);const s=document.getElementById("app")??document.body;s.textContent=`App boot failed: ${String(e)}`});
